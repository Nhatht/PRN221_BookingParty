@page
@model PRN221_GroupProjectBookParty.Pages.Admin.IndexModel

@{
    ViewData["Title"] = "Index";
    Layout = "/Pages/Layout/_LayoutHost.cshtml";
}

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon"
          type="image/x-icon"
          href="https://cdn-icons-png.flaticon.com/512/6556/6556219.png" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
          rel="stylesheet" />

    <link rel="stylesheet" href="~/js/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet"
          href="~/js/vendor/css/core.css"
          class="template-customizer-core-css" />
    <link rel="stylesheet"
          href="~/js/vendor/css/theme-default.css"
          class="template-customizer-theme-css" />
    <link rel="stylesheet" href="~/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet"
          href="~/js/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <!--Thư viện tạo thông báo nhỏ-->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />

    <!-- Page CSS -->
    <!-- Helpers -->
    <script src="~/js/vendor/js/helpers.js"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="~/js/js/config.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Thư viện jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Thư viện Bootstrap JS -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</head>
<h1>User Management</h1>
<style>
    /* The switch - the box around the slider */
    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

        /* Hide default HTML checkbox */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

    /* The slider */
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

    input:checked + .slider {
        background-color: #2196F3;
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

        .slider.round:before {
            border-radius: 50%;
        }

</style>
<form method="get" asp-page="./Index">
    <div class="form-group" style="display: flex;justify-content: space-between;">
        <div>
            <label for="searchQuery">Search:</label>
            <input type="text" id="searchQuery" name="searchQuery" class="form-control" />
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
        <div>
            <a asp-page="Create" class="btn btn-primary">Create New</a>
        </div>

    </div>

</form>
<form method="post" asp-page="./Index">
    <table class="table">
        <thead>
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.Account[0].Email)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Account[0].UserName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Account[0].Phone)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Account[0].Gender)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Account[0].Role)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Account[0].Status)
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Account)
            {

                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.Email)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.UserName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Phone)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Gender)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Role)
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" @(item.Status ? "checked" : "") data-id="@item.Id" class="statusToggle">
                            <span class="slider round"></span>
                        </label>
                    </td>
                    <td>
                        <a asp-page="./Edit" asp-route-id="@item.Id">Edit</a> |
                        <a asp-page="./Details" asp-route-id="@item.Id">Details</a> |
                        <a asp-page="./Delete" asp-route-id="@item.Id">Ban </a>
                    </td>
                </tr>


            }
        </tbody>
    </table>
</form>

<script>
    $(document).ready(function () {
        $('.statusToggle').change(function () {
            var id = $(this).data('id');
            var status = $(this).prop('checked');

            // Gửi yêu cầu cập nhật trạng thái bằng Ajax
            $.ajax({
                url: '/Admin?handler=UpdateStatus',
                method: 'POST',
                data: { id: id, status: status },
                success: function (data) {
                    // Nếu cập nhật thành công, cập nhật giao diện người dùng
                    if (data.success) {
                        // Cập nhật trạng thái của toggle switch
                        $('.statusToggle[data-id="' + id + '"]').prop('checked', status);
                    } else {
                        // Xử lý khi cập nhật không thành công (nếu cần)
                        console.log("Cập nhật không thành công");
                    }
                },
                error: function (xhr, status, error) {
                    // Xử lý lỗi nếu có
                    console.error(error);
                }
            });
        });
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script>
    toastr.options = {
        "closeButton": true,
        "positionClass": "toast-top-right",
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
    }
</script>
